<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>User Management - Meod Farm</title> <!-- changed here -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f2f4f2;
        }

        /* ===== NAVBAR ===== */
        .horizontal-navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #46923c;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .hamburger {
            font-size: 26px;
            cursor: pointer;
            color: white;
        }

        .nav-logo {
            height: 38px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            position: fixed;
            top: 60px;
            left: -260px;
            width: 260px;
            height: calc(100vh - 60px);
            background-color: #f8f8f8;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.2);
            transition: left 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding-top: 10px;
            z-index: 999;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-links a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            text-decoration: none;
            color: #333;
        }

        .sidebar-links a span {
            margin-right: 10px;
        }

        .sidebar-links a:hover {
            background-color: #e6f0e4;
        }

        .logout-btn {
            margin: 20px;
            padding: 12px;
            background-color: #46923c;
            border: none;
            color: white;
            border-radius: 6px;
            cursor: pointer;
        }

        /* ===== MAIN ===== */
        .main-content {
            padding: 90px 30px 30px;
            transition: margin-left 0.3s ease;
        }

        /* ===== CARD & TABLE ===== */
        .card {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .card h3 {
            margin-bottom: 15px;
            color: #2e6b2e;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f0f0f0;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 6px;
        }

        .add-btn {
            background-color: #46923c;
            color: white;
        }

        .edit-btn {
            background-color: #0277bd;
            color: white;
        }

        .delete-btn {
            background-color: #c62828;
            color: white;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10000;
        }

        .modal-content {
            background: white;
            width: 400px;
            padding: 25px;
            border-radius: 12px;
            margin: 8% auto;
        }

        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>

<body>

    <!-- NAVBAR -->
    <nav class="horizontal-navbar">
        <div class="nav-left">
            <span id="hamburger" class="hamburger">&#9776;</span>
            <img src="logo.png" class="nav-logo">
        </div>
    </nav>

    <!-- SIDEBAR -->
    <div id="sidebar" class="sidebar">
       <div class="sidebar-links">

            <a href="employeehomepage.html"><span>üè†</span> Home</a>
            <a href="employeeprofile.html"><span>üë§</span> Profile</a>
            <a href="employeemanagement.html"><span>‚öôÔ∏è</span> Management</a>
            <a href="issue&dashboard.html"><span>üìä</span> Issue & Dashboard</a>
            <a href="ordermanagement.html"><span>üì¶</span> Order Management</a>
            <a href="reviewmanagement.html"><span>‚≠ê</span> Review Management</a>
            <a href="productadministration.html"><span>üßæ</span> Product Administration</a>

        </div>

        <button class="logout-btn" onclick="location.href='startpage.html'">Log out</button>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>User Management</h3> <!-- changed here -->
                <button class="add-btn" onclick="openAdd()">‚ûï Add Employee</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Staff ID</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Role</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="users"></tbody>
            </table>
        </div>

    </div>

    <!-- MODAL -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modal-title">Add Employee</h3>

            <input id="staff_id" placeholder="Staff ID">
            <input id="full_name" placeholder="Full Name">

            <select id="department">
                <option value="">Select Department</option>
                <option value="IT">IT</option>
                <option value="HR">HR</option>
                <option value="Finance">Finance</option>
                <option value="Marketing">Marketing</option>
                <option value="Operations">Operations</option>
            </select>

            <select id="role">
                <option value="">Select Role</option>
                <option value="Developer">Developer</option>
                <option value="Manager">Manager</option>
                <option value="Analyst">Analyst</option>
                <option value="Designer">Designer</option>
                <option value="Team Lead">Team Lead</option>
            </select>

            <input id="work_email" placeholder="Work Email">

            <div class="modal-actions">
                <button class="add-btn" onclick="saveUser()">Confirm</button>
                <button onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('.main-content');
        hamburger.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            mainContent.style.marginLeft = sidebar.classList.contains('open') ? '260px' : '0';
        });

        // Modal & inputs
        const modal = document.getElementById('modal');
        const modal_title = document.getElementById('modal-title');
        const staff_id = document.getElementById('staff_id');
        const full_name = document.getElementById('full_name');
        const department = document.getElementById('department');
        const role = document.getElementById('role');
        const work_email = document.getElementById('work_email');
        const users = document.getElementById('users');

        let editMode = false;
        let editStaffId = null;

        // Load users
        function loadUsers() {
            fetch('/api/users')
                .then(r => r.json())
                .then(data => {
                    users.innerHTML = '';
                    data.forEach(u => {
                        users.innerHTML += `
                <tr>
                    <td>${u.staff_id}</td>
                    <td>${u.full_name}</td>
                    <td>${u.department}</td>
                    <td>${u.role}</td>
                    <td>${u.work_email}</td>
                    <td>
                        <button class="edit-btn" onclick='openEdit(${JSON.stringify(u)})'>Edit</button>
                        <button class="delete-btn" onclick="deleteUser('${u.staff_id}')">Delete</button>
                    </td>
                </tr>`;
                    });
                });
        }

        // Open Add Modal
        function openAdd() {
            editMode = false;
            modal.style.display = 'block';
            modal_title.innerText = 'Add Employee';

            staff_id.disabled = false;
            staff_id.value = 'EMP'; // auto-fill Staff ID

            full_name.value = '';
            department.value = '';
            role.value = '';
            work_email.value = '';

            // Auto-fill email as user types full_name
            full_name.oninput = function () {
                const namePart = full_name.value.toLowerCase().replace(/\s+/g, '');
                work_email.value = namePart ? namePart + '@meod.com' : '';
            };
        }

        // Open Edit Modal
        function openEdit(u) {
            editMode = true;
            editStaffId = u.staff_id;
            modal.style.display = 'block';
            modal_title.innerText = 'Edit Employee';

            staff_id.value = u.staff_id;
            staff_id.disabled = true;
            full_name.value = u.full_name;
            department.value = u.department;
            role.value = u.role;
            work_email.value = u.work_email;

            // Remove auto-fill listener when editing
            full_name.oninput = null;
        }

        // Close modal
        function closeModal() { modal.style.display = 'none'; }

        // Save employee
        function saveUser() {
            if (!staff_id.value || !full_name.value || !department.value || !role.value || !work_email.value) {
                alert('Please fill in all fields.');
                return;
            }

            const data = { staff_id: staff_id.value, full_name: full_name.value, department: department.value, role: role.value, work_email: work_email.value };
            const url = editMode ? `/api/users/${editStaffId}` : '/api/users';
            const method = editMode ? 'PUT' : 'POST';

            fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) })
                .then(r => r.json())
                .then(res => {
                    if (res.success === false) { alert(res.message); return; }
                    closeModal();
                    loadUsers();
                }).catch(err => alert('Error: ' + err));
        }

        // Delete employee
        function deleteUser(staffId) {
            if (!confirm('Are you sure this employee resigned?')) return;
            fetch(`/api/users/${staffId}`, { method: 'DELETE' }).then(() => loadUsers());
        }

        // Initial load
        loadUsers();
    </script>

</body>

</html>